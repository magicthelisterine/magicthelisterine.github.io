function getSimpleHtml(){const e=DocumentApp.getActiveDocument().getBody(),t=e.getNumChildren();let n="",r=[],i=!1,l=!1,p="";for(let o=0;o<t;o++){const t=e.getChild(o),a=t.getType();if(a===DocumentApp.ElementType.LIST_ITEM){const e=t.asListItem(),l=e.getNestingLevel(),p=e.getGlyphType(),o=p&&p.toString().includes("NUMBER")?"ol":"ul",a=parseStyledTextWithBreaks(e).trim();for(;l>r.length-1;)i&&(n+="\n",i=!1),n+=`<${o}>\n`,r.push(o);for(;l<r.length-1;)i&&(n+="</li>\n",i=!1),n+=`</${r.pop()}>\n`;i&&(n+="</li>\n"),n+=`<li>${a}`,i=!0}else if(a===DocumentApp.ElementType.PARAGRAPH){for(i&&(n+="</li>\n",i=!1);r.length>0;)n+=`</${r.pop()}>\n`;const e=t.asParagraph(),o=e.getHeading(),a=stripTextContent(e).trim();if(a.startsWith("<highlight")){l=!0,p=a+"\n";continue}if(l){p+=a+"\n",a.endsWith("</highlight>")&&(n+=p,p="",l=!1);continue}if(o===DocumentApp.ParagraphHeading.TITLE||o===DocumentApp.ParagraphHeading.SUBTITLE)continue;const s=headingToTag(o),g=parseStyledTextWithBreaks(e).trim();s?n+=`<${s}>${g}</${s}>\n`:""!==g&&(isPureHtmlBlock(g)?n+=`${g}\n`:n+=`<p>${g}</p>\n`)}else if(a===DocumentApp.ElementType.TABLE){const e=t.asTable();n+="<table>\n";for(let t=0;t<e.getNumRows();t++){const r=e.getRow(t);n+="  <tr>\n";for(let e=0;e<r.getNumCells();e++){n+=`    <td>${parseStyledTextWithBreaks(r.getCell(e)).trim()}</td>\n`}n+="  </tr>\n"}n+="</table>\n"}}for(i&&(n+="</li>\n");r.length>0;)n+=`</${r.pop()}>\n`;return n}function parseStyledTextWithBreaks(e){let t="";for(let n=0;n<e.getNumChildren();n++){const r=e.getChild(n),i=r.getType();if(i===DocumentApp.ElementType.TEXT){const e=r.asText(),n=e.getTextAttributeIndices();for(let r=0;r<n.length;r++){const i=n[r],l=r+1<n.length?n[r+1]:e.getText().length,p=e.getText().substring(i,l),o=[];e.isBold(i)&&o.push("strong"),e.isItalic(i)&&o.push("em"),e.isUnderline(i)&&o.push("u");let a=escapeHtml(p);for(let e=o.length-1;e>=0;e--)a=`<${o[e]}>${a}</${o[e]}>`;t+=a}}else if(i===DocumentApp.ElementType.TEXT_BREAK)t+="<br>";else if(i===DocumentApp.ElementType.INLINE_IMAGE){const e=r.asInlineImage().getBlob();t+=`<img src="data:${e.getContentType()};base64,${Utilities.base64Encode(e.getBytes())}">`}else i!==DocumentApp.ElementType.PARAGRAPH&&i!==DocumentApp.ElementType.LIST_ITEM||(t+=parseStyledTextWithBreaks(r))}return t}function stripTextContent(e){let t="";for(let n=0;n<e.getNumChildren();n++){const r=e.getChild(n);r.getType()===DocumentApp.ElementType.TEXT?t+=r.asText().getText():r.getNumChildren&&r.getNumChildren()>0&&(t+=stripTextContent(r))}return t}function headingToTag(e){switch(e){case DocumentApp.ParagraphHeading.HEADING1:return"grostitre";case DocumentApp.ParagraphHeading.HEADING2:return"h3";case DocumentApp.ParagraphHeading.HEADING3:return"h4";case DocumentApp.ParagraphHeading.HEADING4:return"h5";case DocumentApp.ParagraphHeading.HEADING5:return"h6";default:return null}}function escapeHtml(e){const t=["table","thead","tbody","tfoot","tr","td","th","dots","checklist","box","highlight"];return e.replace(/<\/?([a-zA-Z0-9\-]+)(\s[^>]*)?>/g,((e,n)=>t.includes(n.toLowerCase())?e:e.replace(/</g,"&lt;").replace(/>/g,"&gt;"))).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function isPureHtmlBlock(e){return!!e.trim().match(/^<([a-zA-Z0-9-]+)(\s[^>]*)?>[\s\S]*<\/\1>$/)}function test(){const e=getSimpleHtml();Logger.log(e)}function doGet(e){try{const e=getSimpleHtml();return ContentService.createTextOutput(e).setMimeType(ContentService.MimeType.HTML)}catch(e){return ContentService.createTextOutput("Erreur: "+e).setMimeType(ContentService.MimeType.TEXT)}}