const thumbnail_path=root+"assets/images/cartes/thumbnails/",CardPool={main:null,modal:null,cards:[],init:async function(){this.modal=new CardModal,this.main=query("main"),Brainstorm.getCards().then((e=>{e.success?(this.cards=e.rows,this.container=create("article"),this.container.replaceChildren(this.renderCards()),this.main.replaceChildren(this.container)):MessageModal.alert(e.errmsg,(()=>{document.location.href=root}))}))},renderCards:function(){const e=create("div","card-grid");return this.cards.forEach((t=>{e.append(this.renderCard(t))})),e},renderCard:function(e){let t=e.type;e.supertype&&(t=e.supertype+" "+t),e.subtype&&(t=t+" - "+e.subtype);let r=this.renderTextSymbols(e.description);e.flavor&&(r+=`<hr><i>${e.flavor}</i>`);let i=null,a=null,s=null;e.image&&(e.image.webp_small&&(i=thumbnail_path+e.image.webp_small),e.image.webp_medium&&(a=thumbnail_path+e.image.webp_medium),e.image.webp_large&&(s=thumbnail_path+e.image.webp_large));let n=null;["Creature","Artifact Creature"].includes(e.type)&&(n=e.power+"/"+e.toughness),e.computed={name:e.name,legend:t,thumb_small:i,thumb_medium:a,thumb_large:s,cost:this.trimBraces(e.cost),cost_render:this.renderSymbols(this.trimBraces(e.cost)),power_toughness:n,description:r};const d=create("div","card-grid__item"),c=d.create("div","card-grid__item__icon");e.computed.thumb_small&&(c.style.backgroundImage="url("+e.computed.thumb_small+")");const o=d.create("div","card-grid__item__details");o.create("div","card-grid__item__details__name",e.computed.name);const l=o.create("div","card-grid__item__details__description");return l.create("div","card-grid__item__details__description__legend",e.computed.legend),l.create("div","card-grid__item__details__description__power_toughness",e.computed.power_toughness),l.create("div","card-grid__item__details__description__cost",e.computed.cost_render),d.addEventListener("click",(t=>{this.modal.show(e.computed)})),d},renderSymbols:function(e){let t="";return[...String(e).matchAll(/\{(.*?)\}/g)].map((e=>e[1])).forEach((e=>{t+=`<div class="symbol-1em icon-${e}"></div>`})),t},renderTextSymbols:function(e){return String(e).replace(/\n/g,'<span class="line-break"></span>').replace(/\{i\}(.*?)\{\/i\}/gi,"<em>$1</em>").replace(/\{(?!\/?i\})(.*?)\}/gi,((e,t)=>`<div class="symbol-1em icon-${t.toUpperCase()}"></div>`))},trimBraces:function(e){return(e.match(/{[^}]*}/g)||[]).join("")}};class CardModal extends Modal{constructor(){super(),this.cont.addEventListener("mousedown",(e=>{this.hide()})),document.addEventListener("keydown",(e=>{this.opened&&"Escape"===e.key&&!(e.ctrlKey||e.altKey||e.shiftKey)&&this.hide()}))}show(e){const t=create("div","cardinfo"),r=t.create("div","cardinfo__thumb");e.thumb_medium&&(r.style.backgroundImage="url("+e.thumb_medium+")"),t.create("div","cardinfo__name",e.name),t.create("div","cardinfo__legend",e.legend),t.create("div","cardinfo__cost","<strong>Co√ªt:</strong> "+e.cost_render),t.create("div","cardinfo__power_toughness","<strong>Force/Endurance:</strong> "+(e.power_toughness?e.power_toughness:"")),t.create("div","cardinfo__description",e.description),super.show(t)}cancel(){this.hide()}}