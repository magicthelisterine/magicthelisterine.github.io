var r=Object.defineProperty;var u=(i,t,e)=>t in i?r(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var l=(i,t,e)=>u(i,typeof t!="symbol"?t+"":t,e);const SubmitForm={data:null,name:null,serie:null,supertype:null,type:null,dnd:null,desc:null,submitbtn:null,loadingModal:null,emailModal:null,init:function(i){this.data=i,this.dnd=document.getElementById("dnd"),this.name=document.getElementById("name"),this.serie=document.getElementById("serie"),this.supertype=document.getElementById("supertype"),this.type=document.getElementById("type"),this.desc=document.getElementById("desc"),this.submitbtn=document.getElementById("submit-btn"),this.fillSerie(i.series),this.fillSuperType(i.supertypes),this.fillType(i.types),DropImage.init(this.dnd),HintSymbols.init(),MTGEditor.init(this.desc),this.loadingModal=new LoadingModal,this.emailModal=new EmailModal,bind(".card-submit-container form","submit",t=>{t.preventDefault(),this.submit()})},fillSerie:function(i){i.forEach(t=>{const e=create("option");e.innerText=t,e.value=t,this.serie.append(e)})},fillSuperType:function(i){i.forEach(t=>{const e=create("option");e.innerText=t,e.value=t,this.supertype.append(e)})},fillType:function(i){i.forEach(t=>{const e=create("option");e.innerText=t,e.value=t,this.type.append(e)})},progress:function(i){this.submitbtn.disabled=i<1},submit:function(){if(!DropImage.value){DropImage.div.classList.add("dragover"),scrollTo(DropImage.div);return}this.emailModal.show((i,t)=>{const e={author:i,email:t,name:document.getElementById("name").value,serie:document.getElementById("serie").value,supertype:document.getElementById("supertype").value,type:document.getElementById("type").value,subtype:document.getElementById("subtype").value,power:document.getElementById("power").value,toughness:document.getElementById("toughness").value,cost:document.getElementById("costInput").value,description:document.getElementById("desc").value,flavor:document.getElementById("flavor").value,image:{filename:DropImage.value.name,image:DropImage.value.contents}};this.loadingModal.show(),Brainstorm.addCard(e).then(s=>{this.loadingModal.hide(),s.success?MessageModal.thumbsup("Bravo! Votre carte vient d\u2019\xEAtre envoy\xE9e dans le Plan Astral du comit\xE9 \xE9ditorial. Si elle survit au sort de Contrebullshit, elle sera publi\xE9e bient\xF4t.",()=>{document.location.href="../"}):MessageModal.alert(`Une erreur s'est produite.<br>${s.errmsg}`)})})}};window.SubmitForm=SubmitForm;const HintSymbols={symbols:["U","G","B","W","R","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","2B","2G","2R","2U","2W","BG","BR","GU","GW","RG","RW","UB","UR","WB","WU","X","Y","Z","C"],hintBox:null,input:null,cost:null,init:function(){this.hintBox=document.body.create("div","card-submit-cost-symbols"),this.input=document.getElementById("costInput"),this.cost=document.getElementById("costRender"),this.symbols.forEach(t=>{this.hintBox.create("div","symbol-24px icon-"+t).bind("click",s=>{this.input.value+="{"+t+"}",this.renderCost()})}),this.input.bind("input",t=>{this.renderCost()});let i=!1;this.input.addEventListener("focus",()=>{this.hintBox.style.display="block",this.hintBox.style.visibility="hidden";const t=this.input.getBoundingClientRect(),e=this.hintBox.offsetHeight;this.hintBox.style.left=t.left+window.scrollX+"px",this.hintBox.style.top=t.top+window.scrollY-e-8+"px",this.hintBox.style.visibility="visible"}),this.input.addEventListener("blur",()=>{i||(this.hintBox.style.display="none")}),this.hintBox.addEventListener("mousedown",()=>{i=!0}),this.hintBox.addEventListener("mouseup",()=>{setTimeout(()=>{i=!1,this.input.focus()},0)})},renderCost:function(){let i="";[...this.input.value.matchAll(/\{(.*?)\}/g)].map(e=>e[1]).forEach(e=>{i+=`<div class="symbol-24px icon-${e}"></div>`}),this.cost.innerHTML=i}},DropImage={div:null,value:null,init:function(i){this.div=i,this.div.addEventListener("dragover",t=>{t.preventDefault(),this.div.classList.add("dragover")}),this.div.addEventListener("dragleave",()=>{this.div.classList.remove("dragover")}),this.div.addEventListener("drop",t=>{t.preventDefault(),this.div.classList.remove("dragover");const e=t.dataTransfer.files;e.length>0&&this.handleFile(e[0])}),this.div.addEventListener("click",t=>{browse("image/*",e=>{e.target.files.length>0&&this.handleFile(e.target.files[0])}),this.div.classList.remove("dragover")})},handleFile:function(i){if(i.type.startsWith("image/")&&i.size<=5242880){const t=new FileReader;t.onload=e=>{this.value={name:i.name,size:i.size,type:i.type,contents:e.target.result},this.div.style.setProperty("--bg-image",`url("${e.target.result}")`)},t.readAsDataURL(i)}}},MTGEditor={symbols:["I","U","G","B","W","R","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","2B","2G","2R","2U","2W","BG","BR","GU","GW","RG","RW","UB","UR","WB","WU","X","Y","Z","T","T1","T2"],toolbar:null,elm:null,init:function(i){this.elm=i,this.toolbar=create("div","MTGEditor-toolbar"),this.elm.parentElement.insertBefore(this.toolbar,this.elm),this.symbols.forEach(t=>{this.toolbar.create("div","symbol-24px icon-"+t).bind("click",s=>{t=="I"?this.wrapItalic():this.insert("{"+t+"}")})})},insert:function(i){const t=this.elm.selectionStart,e=this.elm.selectionEnd,s=this.elm.value.substring(0,t),n=this.elm.value.substring(e);this.elm.value=s+i+n;const o=t+i.length;this.elm.selectionStart=this.elm.selectionEnd=o,this.elm.focus()},wrapItalic:function(){const i=this.elm.selectionStart,t=this.elm.selectionEnd,e=this.elm.value.substring(i,t);let s,n;e.length>0?(s=`{I}${e}{/I}`,n=i+s.length):(s="{I}{/I}",n=i+3);const o=this.elm.value.slice(0,i),a=this.elm.value.slice(t);this.elm.value=o+s+a,this.elm.selectionStart=this.elm.selectionEnd=n,this.elm.focus()}};class EmailModal extends Modal{constructor(){let e=create("form","email-modal");e.innerHTML='<table><thead><tr><th colspan="2">Auteur</th></tr></thead><tbody><tr><td colspan="2"><input type="text" name="name" autocomplete="off" placeholder="Nom" required></td></tr><tr><td colspan="2"><input type="email" name="email" autocomplete="off" placeholder="Courriel" required></td></tr></tbody><tfoot><tr><td class="cell-half-width"><input type="submit" name="save" value="Confirmer"></td><td class="cell-half-width"><input type="button" name="cancel" value="Annuler"></td></tr></tfoot></table>';super(e);l(this,"form",null);l(this,"clb",null);this.form=e,bind(this.form,"submit",s=>{s.preventDefault(),this.save()}),this.form.querySelector('input[name="cancel"]').addEventListener("click",s=>{this.cancel()})}show(e=null){this.clb=e,this.form.querySelector('input[name="name"]').value=localStorage.getItem("submit-author_name"),this.form.querySelector('input[name="email"]').value=localStorage.getItem("submit-author_email"),super.show(),setTimeout(()=>{this.form.querySelector('input[name="name"]').focus()},200)}save(){const e=this.form.querySelector('input[name="name"]').value,s=this.form.querySelector('input[name="email"]').value;localStorage.setItem("submit-author_name",e),localStorage.setItem("submit-author_email",s),this.hide(),this.clb&&this.clb(e,s)}cancel(){this.hide()}}class LoadingModal extends Modal{constructor(){let e=create("div","loading-tri-circular center");super(e);l(this,"loading",null);this.loading=e}show(){this.loading.style.setProperty("--state","running"),super.show()}hide(){super.hide(),this.loading.style.setProperty("--state","paused")}}
